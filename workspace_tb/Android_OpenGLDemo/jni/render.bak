#include <stdio.h>

#include <jni.h>
#include <android/log.h>
#include <GLES/gl.h>

#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, "renderer", __VA_ARGS__) 

void debugError(char* str) {
    int error = glGetError();
    if (error != GL_NO_ERROR) {
        LOGD("error: %s\t error code: %x ", str, error);
    }
}

void setupPoints() {
    glEnableClientState(GL_VERTEX_ARRAY);
    glEnableClientState(GL_COLOR_ARRAY);

    float vertexs[] = {
        0.0f, 0.0f,
        0.0f, 0.5f,
        0.5f, 0.0f,
    };
    glVertexPointer(2, GL_FLOAT, 0, vertexs);


    float color[] = {
        1.0f, 0.0f, 0.0f, 1.0f,
        1.0f, 0.0f, 0.0f, 1.0f,
        1.0f, 0.0f, 0.0f, 1.0f,
    };
    glColorPointer(4, GL_FLOAT, 0, color);
    debugError("11");
}

void
Java_opengl_demo_MyRenderer_init(JNIEnv *env, jobject thiz) {
    glClearColor(1.0f, 1.0f, 1.0f, 1.0f);
    debugError("10");
}

void
Java_opengl_demo_MyRenderer_change(JNIEnv *env, jobject thiz, int width, int height) {
    glViewport(0, 0, width, height);
    debugError("4");

    glMatrixMode(GL_PROJECTION);
    setupPoints();
    debugError("5");
    glLoadIdentity();
    debugError("6");
    float ratio = (float)width/height;
    glOrthof(-ratio, ratio, -1, 1, 1, 10);
    debugError("7");

    glMatrixMode(GL_MODELVIEW);
    debugError("8");
    glLoadIdentity();
    debugError("9");

    debugError("10");
}

void
Java_opengl_demo_MyRenderer_step(JNIEnv *env, jobject thiz) {
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

    debugError("2");
    glDrawArrays(GL_LINE_LOOP, 0, 2);
    /*debugError("3");*/
}
